on:
  pull_request:
    branches:
      - master

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: 17
          distribution: temurin
          cache: 'gradle'
      - name: Change wrapper permission
        run: chmod +x ./gradlew

      - name: Create dummy commit
        env:
          GH_TOKEN: ${{ github.token }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          FILE_TO_COMMIT: date
          DESTINATION_BRANCH: automatic
        run: |
          date > $FILE_TO_COMMIT 
          export TODAY=$( date -u '+%Y-%m-%d' )
          export MESSAGE="chore: regenerate $FILE_TO_COMMIT for $TODAY"
          
          gh api graphql \
            -F $githubRepository="owner/repo" \
            -F branchName=$DESTINATION_BRANCH \
            -F expectedHeadOid=$(git rev-parse HEAD) \
            -F commitMessage=$MESSAGE \
            -F files[][path]="date" -F files[][contents]=$(base64 -w0 date)
            -F 'query=@.github/api/createCommitOnBranch.gql'
